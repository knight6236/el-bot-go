# 配置语法说明

# 通用配置

## 生效范围

```yml
global:
friend:
group:
```

| 关键字 | 必要 | 说明                                             |
| ------ | ---- | ------------------------------------------------ |
| global | 否   | 此关键字下的配置在接收到好友消息和群消息时均生效 |
| friend | 否   | 此关键字下的配置在接收到好友消息时生效           |
| group  | 否   | 此关键字下的配置群消息时生效                     |



## 基本结构

```yml
when:
  countID:
  sender:
  operation:
  message:
do:
  count:
  receiver:
  operation:
  message:
```

| 关键字    | 必要 | 说明                                              |
| --------- | ---- | ------------------------------------------------- |
| when      | 是   | 表示此配置触发的条件。                            |
| do        | 是   | 表示此配置触发后执行的动作。                      |
| countID   | 否   | 当`count: true`是必须填写，用于记录配置触发日志。 |
| sender    | 否   | 表示消息的发送者。                                |
| operation | 否   | 表示一些动作或事件，如新成员入群，禁言等。        |
| message   | 否   | 表示消息，包括文本、图片、表情和 XML。            |


## sender

```yml
sender:
  group:
    - 群号
    ...
  friend:
    - QQ号
    ...
```

| 关键字 | 必要 | 说明                                                         |
| ------ | ---- | ------------------------------------------------------------ |
| group  | 否   | 表示消息来源的群号，可包括若干个群号。                       |
| friend | 否   | 表示消息来源的「群成员」或好友的「QQ号」，可以包括若干个「QQ号」。 |


## receiver

```yml
receiver:
  group:
    - 群号
    ...
  friend:
    - QQ号
    ...
```

| 关键字 | 必要 | 说明                                                         |
| ------ | ---- | ------------------------------------------------------------ |
| group  | 否   | 表示接受消息的群的群号，可包括若干个群号。                   |
| friend | 否   | 表示接受消息的「群成员」或好友的「QQ号」，可以包括若干个「QQ号」。 |

## operation

```yml
operation:
  - type: 
    other:
```

| 关键字 | 必要 | 接受消息时的作用                        | 发送消息时的作用                        |
| ------ | ---- | --------------------------------------- | --------------------------------------- |
| type   | 是   | 表示事件/操作的类型。                   | 表示操作的类型。                        |
| other  | 否   | 根据 `type`的不同会有不同的名字和作用。 | 根据 `type`的不同会有不同的名字和作用。 |

### 事件/操作类型

| 关键字            | 接受消息时的作用     | 发送消息时的作用 | 附属关键字 | 接受消息时附属关键字的作用 | 发送消息时附属关键字的作用 |
| ----------------- | -------------------- | ---------------- | ---------- | -------------------------- | -------------------------- |
| At                | 表示某成员被 At      | At 某成员        | id         | 无                         | 被 At 的成员的「QQ号」     |
| AtAll             | 管理员 At 了全体成员 | At 全体成员      | 无         | 无                         | 无                         |
| MemeberMute       | 某成员被禁言         | 无               | 无         | 无                         | 无                         |
| MemberUnMute      | 某成员被解除禁言     | 无               | 无         | 无                         | 无                         |
| GroupMuteAll      | 管理员开启群员禁言   | 无               | 无         | 无                         | 无                         |
| GroupUnMuteAll    | 管理员关闭群员禁言   | 无               | 无         | 无                         | 无                         |
| MemberJoin        | 新成员入群           | 无               | 无         | 无                         | 无                         |
| MemberLeaveByKick | 成员被管理员移除     | 无               | 无         | 无                         | 无                         |
| MemberLeaveByQuit | 成员主动退群         | 无               | 无         | 无                         | 无                         |


## message

```yml
message:
  - type:
    other:
```

| 关键字 | 必要 | 接受消息时的作用                        | 发送消息时的作用 |
| ------ | ---- | --------------------------------------- | ---------------- |
| type   | 是   | 接收到的消息的类型                      | 发送的消息的类型 |
| other  | 否   | 根据 `type`的不同会有不同的名字和作用。 |                  |

### 消息类型

| 关键字 | 接受消息时的作用      | 发送消息时的作用      | 附属关键字 | 接受消息时附属关键字的作用         | 发送消息时附属关键字的作用                                   |
| ------ | --------------------- | --------------------- | ---------- | ---------------------------------- | ------------------------------------------------------------ |
| Plain  | 表示接收到的文本消息  | 表示发送的文本消息    | text       | 表示要接受到的文本                 | 表示要发送的文本                                             |
|        |                       |                       | regex      | 使用对应正则表达式匹配接收到的文本 | 无                                                           |
| Image  | 表示接收到的图片      | 表示发送的图片        | url        | 无                                 | 要发送的图片的 URL                                           |
|        |                       |                       | path       | 无                                 | 要发送的图片的路径（相对于`plugins/MiraiAPIHTTP/images`）    |
|        |                       |                       | reDirect   | 无                                 | 如果要发送的图片的 URL 会重定向到其它  URL 则设置为`true`，反之则忽略。 |
| Face   | 表示接收到的表情      | 表示发送的表情        | name       | 接收到的表情的名称                 | 要发送的表情的名称                                           |
| Xml    | 表示接收到的 XML 文本 | 表示要发送的 XML 文本 | text       | 无                                 | 表示要发送的 XML 文本内容                                    |


## 预定义变量

有时我们可能需要一些额外信息，如本次接收到的消息，新进群的成员的 QQ 号，被禁言的成员的群名片等。

[预定义变量](pre-def-var.md)

## 配置举例

### 一问一答型

```yml
# 当接收到的群消息或好友消息为 hello 或「你好」时回复「Hello World!（你好 世界！）」
global:
  - when:
      message:
        - type: Plain
          text: hello
        - type: Plain
          text: 你好
    do:
      message:
        - type: Plain
          text: Hello World!
        - type: Plain
          text: （你好 世界！）
```

### 复读机型

```yml
global:
  # 当文本消息符合正则表达式时复读本次消息
  - when:
      message:
        - type: Plain
          regex: 复读
    do:
      message:
        - type: Plain
          text: '{el-message-text}'
```

### 发送网络图片

```yml
global:
  # 当文本消息为 img 时发送 URL 指向的图片
  - when:
      message:
        - type: Plain
          text: img
    do:
      message:
        - type: Image
          url: https://xxxx
```

### 成员被禁言时发送消息

```yml
group:
  # 当某个成员被禁言时发送「「被禁言成员群昵称」喜提禁言套餐」
  - when:
      operation:
        - type: MemberMute
    do:
      message:
        - type: Plain
          text: 「{el-target-name}」喜提禁言套餐
```

更多例子见 `config/default.yml`
